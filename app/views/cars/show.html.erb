<div class="text-center title-padding">
  <h1><%= @car.brand %> <%= @car.model %></h1>
  <div class="show_image">
    <%= cl_image_tag @car.photo, height: 500, width: 800, crop: :fill%>
    <h2>Average Rating</h2>
    <% if @average_rating %>
      <% @average_rating.times do %>
        <i class="fas fa-star yellow-star"></i>
      <% end %>
    <% end %>
  </div>
</div>
<hr>
<div class="container">
  <div class="row">
    <div class="col-sm-4 col-sm-offset-2">
      <div class= "new-desc-card">
        <h4><%= @car.brand %> <%= @car.model %></h4>
        <table>
          <tr>
            <td>Year:</td>
            <td><%= @car.year %></td>
          </tr>
          <tr>
            <td>Mileage:</td>
            <td><%= @car.mileage %></td>
          </tr>
          <tr>
            <td>Body Type:</td>
            <td><%= @car.body_type %></td>
          </tr>
          <tr>
            <td>Transmission:</td>
            <td><%= @car.transmission %></td>
          </tr>
          <tr>
            <td>Location:</td>
            <td><%= @car.location %></td>
          </tr>
          <tr>
            <td>Price:</td>
            <td><%= @car.price %> USD</td>
          </tr>
        </table>
        <div class="wrapper-button">
          <div class="item">
            <% unless @car.user != current_user %>
              <%= link_to "Delete listing", car_path(@car),
            method: :delete,
            data: { confirm: "Are you sure you want to delete this listing?" },class: 'btn btn-danger'
            %>
            <% end %>
          </div>
          <div class="item">
            <div class = "btns-end  col-sm-8">
              <%= link_to "Go to listings", cars_path, class: 'btn btn-primary'%>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% unless @car.user == current_user %>
      <div class="wrapper-booking-form">
        <div class="col-sm-4 col-sm-offset-0">
          <div class="booking-card">
            <h3>Booking Information</h3>
            <%= render 'bookings/form', booking: @booking %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="map-style">
        <div
        id="map"
        style="width: 800px;
        height: 600px;"
        data-markers="<%= @markers.to_json %>"
      >
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <% if @unreviewed_bookings.any? %>
      <div class="row">
        <h1 class="text-center">Write A Review</h1>
        <div class="review-card">
          <% @unreviewed_bookings.each do |unreviewed_booking| %>
            <div class="col-xs-12 offset-sm-6">
              <div class="review-separator">
                <p>Booking made on <strong> <%= unreviewed_booking.created_at.strftime("%b %e, %Y - %l:%M %p") %></strong></p>
                <p>Booked From <strong><%= unreviewed_booking.start_date.strftime("%b %d, %Y") %> to: <%= unreviewed_booking.end_date.strftime("%b %d, %Y") %></strong></p>
                <% if Date.today >= unreviewed_booking.end_date %>
                  <%= render 'reviews/form', review: @review, unreviewed_booking: unreviewed_booking %>
                <% else %>
                  <h5> <i> - You can write a review after the booking period -</i></h5>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
    <hr>
    <h1 class="text-center">Reviews</h1>
    <hr>
    <div class="row">
      <% @car.reviews.order("created_at DESC").each do |review| %>
        <div class="review-separator">
          <h5><%= cl_image_tag review.user.photo, class: "avatar img-circle" %><strong> By <%= review.user.first_name %> <%= review.user.last_name %> from <i><%= review.created_at.strftime("%b %Y") %></i></strong>
          </h5>
          <% review.rating.times do %>
            <i class="fas fa-star"></i>
          <% end %>
          <p><%= review.content %></p>
        </div>
      <% end %>
    </div>
  </div>
